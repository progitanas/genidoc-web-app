<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="icon" type="image/png" href="/static/ong_GeniDoc1preview.png" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accueil — Carte Vitale GeniDoc</title>
  <style>
    .profile-dropdown .logout-btn {
      margin-top: 18px;
      width: 100%;
      background: #fff;
      color: #d32f2f;
      border: 1.5px solid #d32f2f;
      border-radius: 8px;
      padding: 10px 0;
      font-size: 1em;
      font-weight: 700;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    .profile-dropdown .logout-btn:hover {
      background: #d32f2f;
      color: #fff;
    }
    .header-flex {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 24px;
      margin-bottom: 32px;
      max-width: 950px;
      width: 100%;
    }
    .profile-menu {
      position: relative;
      display: inline-block;
    }
    .profile-btn {
      background: #fff;
      border: none;
      border-radius: 50%;
      box-shadow: 0 2px 8px #2056ae22;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: box-shadow 0.2s;
      margin-left: 18px;
    }
    .profile-btn:hover {
      box-shadow: 0 4px 16px #2056ae44;
    }
    .profile-dropdown {
      display: none;
      position: fixed;
      right: 48px;
      top: 90px;
      background: #fff;
      min-width: 260px;
      box-shadow: 0 8px 32px #2056ae22;
      border-radius: 16px;
      z-index: 100;
      padding: 22px 28px;
      font-size: 1em;
      color: #222;
    }
    .profile-dropdown.active {
      display: block;
    }
    .profile-dropdown label {
      font-weight: 600;
      color: #2056AE;
      margin-top: 8px;
      display: block;
    }
    .profile-dropdown .profile-value {
      margin-bottom: 8px;
      color: #333;
      font-weight: 400;
      word-break: break-all;
    }
    /* Effet glassmorphism pour la carte vitale */
    .vitale-glass {
      background: rgba(255,255,255,0.7);
      border-radius: 22px;
      box-shadow: 0 8px 32px #4d3aff22, 0 0 0 4px #4d3aff11;
      backdrop-filter: blur(8px);
      border: 2px solid #4D3AFF33;
      padding: 32px 32px 24px 32px;
      max-width: 400px;
      margin: 0 auto 32px auto;
      position: relative;
      text-align: left;
      transition: box-shadow 0.2s;
    }
    .vitale-glass .badge-secure {
      position: absolute;
      top: 18px;
      right: 24px;
      background: #4D3AFF;
      color: #fff;
      font-size: 0.85em;
      font-weight: 700;
      border-radius: 8px;
      padding: 4px 12px;
      letter-spacing: 0.04em;
      box-shadow: 0 2px 8px #4d3aff33;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .vitale-glass .badge-secure svg {
      width: 16px; height: 16px;
      vertical-align: middle;
    }
    .vitale-glass .genidoc-id {
      color: #3a2aff;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 8px;
    }
    .vitale-glass .date-inscription {
      color: #555;
      font-size: 0.98em;
    }
    .vitale-glass .title {
      font-size: 1.25em;
      font-weight: 700;
      margin-bottom: 10px;
      color: #222;
    }
    .vitale-btn {
      background: #2056AE !important;
      color: #fff;
      border: none;
      border-radius: 18px;
      box-shadow: 0 4px 24px #2056ae22;
      padding: 18px 0;
      width: 100%;
      max-width: 400px;
      min-height: 60px;
      font-size: 1.15em;
      font-weight: 700;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.2s, background 0.2s;
      margin: 0 auto 32px auto;
      display: block;
    }
    .vitale-btn:hover {
      box-shadow: 0 8px 32px #2056ae44;
      transform: scale(1.03);
      background: #174080 !important;
    }
    /* Grille responsive 2x2 pour les modules */
    .modules-grid2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(220px, 1fr));
      gap: 32px;
      justify-content: center;
      margin: 40px auto 0 auto;
      width: 100%;
      max-width: 800px;
    }
    @media (max-width: 700px) {
      .modules-grid2 { grid-template-columns: 1fr; }
    }
    /* Carte vitale effet flip */
    .vitale-flip-container {
      perspective: 900px;
      width: 350px;
      margin: 0 auto 32px auto;
      height: 180px;
    }
    .vitale-flip {
      width: 100%;
      height: 100%;
      position: relative;
      transition: transform 0.7s cubic-bezier(.4,0,.2,1);
      transform-style: preserve-3d;
    }
    .vitale-flip.flipped {
      transform: rotateY(180deg);
    }
    .vitale-face, .vitale-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 18px;
      box-shadow: 0 8px 32px #4d3aff22, 0 0 0 4px #4d3aff11;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(90deg,#4D3AFF 60%,#00558C 100%);
      color: #fff;
      font-size: 1.25em;
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    .vitale-back {
      background: #fff;
      color: #222;
      transform: rotateY(180deg);
      flex-direction: column;
      padding: 24px 18px 18px 18px;
      font-size: 1.08em;
      font-weight: 500;
      align-items: flex-start;
      justify-content: center;
    }
    .vitale-back .genidoc-id {
      color: #4D3AFF;
      font-weight: bold;
      margin-bottom: 6px;
    }
    .vitale-back .date-inscription {
      color: #555;
      font-size: 0.98em;
    }
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      background: #f5f7fa;
      margin: 0;
    }
    .main-top {
      width: 100%;
      max-width: 950px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 36px;
    }
    .main-bottom {
      width: 100%;
      max-width: 950px;
      margin: 0 auto 32px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
    }
    .header-flex {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 32px;
      margin: 0 auto 32px auto;
      max-width: 900px;
      flex-wrap: wrap;
    }
    .header-flex .welcome {
      font-size: 1.15em;
      color: #222;
      font-weight: 500;
      min-width: 180px;
      text-align: left;
    }
    .header-flex .logo-accueil img {
      height: 64px;
      width: auto;
      display: block;
    }
    .header-flex .vitale-block {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 220px;
    }
    .header-flex .vitale-title {
      font-size: 1.15em;
      font-weight: 700;
      margin-bottom: 4px;
      letter-spacing: 0.01em;
    }
    .header-flex .genidoc-id, .header-flex .date-inscription {
      font-size: 1em;
      color: #333;
      margin-bottom: 2px;
    }
    .vitale-btn {
      background: linear-gradient(90deg,#4D3AFF 60%,#00558C 100%);
      color: #fff;
      border: none;
      border-radius: 18px;
      box-shadow: 0 4px 24px #4d3aff22;
      padding: 0;
      width: 100%;
      max-width: 350px;
      min-height: 80px;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.2s;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .vitale-btn:hover { box-shadow: 0 8px 32px #4d3aff44; transform: scale(1.03); }
    .vitale-btn .logo img { height: 48px; margin-right: 18px; }
    .vitale-details {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px #4d3aff22;
      padding: 24px 18px 18px 18px;
      margin: 0 auto 24px auto;
      max-width: 350px;
      width: 100%;
      text-align: center;
      opacity: 0;
      transform: translateY(-16px) scale(0.98);
      pointer-events: none;
      transition: opacity 0.35s cubic-bezier(.4,0,.2,1), transform 0.35s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 8px 32px #4d3aff22, 0 0 0 4px #4d3aff11;
    }
    .vitale-details.active {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }
    .modules-vertical {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 28px;
      margin: 40px 0 0 0;
      width: 100%;
    }
    .module-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 16px #4d3aff11;
      padding: 32px 24px;
      width: 100%;
      max-width: 350px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      margin: 0 auto;
    }
    .module-card:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 8px 32px #4d3aff22; }
    .module-card.disabled, .module-card[disabled] {
      opacity: 0.7;
      cursor: not-allowed;
      pointer-events: none;
    }
    .logo-accueil {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 18px;
    }
    .logo-accueil img {
      height: 64px;
      width: auto;
    }
    .vitale-details {
      margin-bottom: 18px;
    }
    .module-card .icon {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 48px;
      margin-bottom: 12px;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f7fa;
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card-vitale {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.10);
      padding: 32px 28px 24px 28px;
      max-width: 350px;
      width: 100%;
      text-align: center;
      position: relative;
    }
    .card-vitale .logo {
      margin-bottom: 18px;
    }
    .card-vitale .logo img {
      height: 60px;
    }
    .card-vitale .genidoc-id {
      font-size: 1.1em;
      font-weight: bold;
      color: #4D3AFF;
      margin-bottom: 8px;
    }
    .card-vitale .date-inscription {
      color: #555;
      font-size: 0.98em;
      margin-bottom: 18px;
    }
    .card-vitale .btn-rdv {
      background: #4D3AFF;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.2s;
      margin-top: 10px;
    }
    .card-vitale .btn-rdv:hover {
      background: #3729b6;
    }
  </style>
</head>
<body>
  <div class="main-top">
    <div class="header-flex">
      <div class="welcome" style="min-width:220px;display:flex;align-items:center;gap:18px;">
        <span>Bienvenue à votre espace patient,<br>Ravis de vous revoir !</span>
        <span class="logo-accueil"><img src="/static/genidoc-logo.png" alt="GeniDoc logo" /></span>
      </div>
      <div class="profile-menu">
        <button class="profile-btn" id="profileBtn" title="Profil patient">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2056AE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-7 8-7s8 3 8 7"/></svg>
        </button>
        <div class="profile-dropdown" id="profileDropdown">
          <button class="logout-btn" id="logoutBtn">Se déconnecter</button>
          <label>Email (Gmail)</label>
          <div class="profile-value" id="profile-email">user@gmail.com</div>
          <label>Mot de passe</label>
          <div class="profile-value" id="profile-password">••••••••</div>
          <label>Date de naissance</label>
          <div class="profile-value" id="profile-birth">1990-01-01</div>
          <label>Username</label>
          <div class="profile-value" id="profile-username">patient123</div>
        </div>
      </div>
    </div>
    <div class="vitale-glass" id="vitaleGlass" style="display:none;">
      <div class="badge-secure">
        <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><circle cx="12" cy="8" r="1"/></svg>
        Sécurisé
      </div>
      <div class="title">Carte Vitale GeniDoc</div>
      <div class="genidoc-id">GeniDoc ID : <span id="genidoc-id">GD-678442</span></div>
      <div class="date-inscription">Date d'inscription : <span id="date-inscription"></span></div>
    </div>
    <button class="vitale-btn" id="vitaleBtn">
      Afficher la carte vitale
    </button>
  </div>
  <div class="main-bottom">
    <div class="modules-grid2">
      <div class="module-card" onclick="window.location.href='appintment.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="4"/><path d="M16 2v4M8 2v4M3 10h18"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">Prendre un rendez-vous</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Réservez une consultation ou un service santé en 1 clic.</div>
      </div>
      <div class="module-card" onclick="window.location.href='genidoc-map.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10A15.3 15.3 0 0 1 12 2z"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">GeniDoc Map</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Trouvez cabinets, hôpitaux et pharmacies autour de vous.</div>
      </div>
      <div class="module-card" onclick="window.location.href='teleconsultation.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="15" rx="3"/><path d="M16 3v4M8 3v4M12 12v2"/><circle cx="18" cy="12" r="2"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">GeniDoc Téléconsultation</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Consultez un médecin en visio, sans vous déplacer.</div>
      </div>
      <div class="module-card" onclick="window.location.href='alertes.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9v2m0 4h.01"/><path d="M5.07 19H19a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2z"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">GeniDoc Alertes Locales</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Soyez informé des campagnes de vaccination, alertes sanitaires ou nouvelles réglementations dans votre ville.</div>
      </div>
      <div class="module-card" onclick="window.location.href='transport.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="10" rx="3"/><path d="M7 17v2a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-2"/><circle cx="7" cy="19" r="2"/><circle cx="17" cy="19" r="2"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">Transport sanitaire</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Réservez une ambulance ou trouvez un covoiturage médical à moindre coût.</div>
      </div>
      <div class="module-card" onclick="window.location.href='pharmacie.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="4"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">Pharmacie numérique</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Gérez vos ordonnances et stocks de médicaments en ligne.</div>
      </div>
      <div class="module-card" onclick="window.location.href='accessibilite.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 8v4"/><path d="M12 16h.01"/><path d="M8 16a4 4 0 0 1 8 0"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">Langues & accessibilité</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Interface multilingue, options audio/visuel, vidéos explicatives.</div>
      </div>
      <div class="module-card" onclick="window.location.href='urgences.html'">
        <div class="icon">
          <svg width="38" height="38" viewBox="0 0 24 24" fill="none" stroke="#4D3AFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 22 22 22 12 2"/><circle cx="12" cy="17" r="1"/><path d="M12 9v4"/></svg>
        </div>
        <div style="font-weight:700;font-size:1.1em;">Gestion des urgences</div>
        <div style="color:#555;font-size:.98em;margin-top:8px;">Consignes, numéros d'urgence, carte des points d'urgence et rassemblement.</div>
      </div>
    </div>
  </div>
  <script>
    // Confirmation déconnexion
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.onclick = (e) => {
        e.preventDefault();
        if (confirm('Voulez-vous vraiment vous déconnecter ?')) {
          window.location.href = 'auth.html';
        }
      };
    }
    // Menu profil déroulant
    const profileBtn = document.getElementById('profileBtn');
    const profileDropdown = document.getElementById('profileDropdown');
    profileBtn.onclick = (e) => {
      e.stopPropagation();
      profileDropdown.classList.toggle('active');
    };
    document.body.addEventListener('click', () => {
      profileDropdown.classList.remove('active');
    });
    // Récupère le GeniDoc ID depuis l'URL si présent
    const params = new URLSearchParams(window.location.search);
    const genidocId = params.get('genidocId');
    if (genidocId) {
      document.getElementById('genidoc-id').textContent = genidocId;
      // Récupère les infos patient depuis l'API
      fetch(`/api/patient/${genidocId}`)
        .then(r => r.json())
        .then(data => {
          if (data.success && data.data) {
            const p = data.data;
            document.getElementById('profile-email').textContent = p.email || '';
            document.getElementById('profile-password').textContent = p.password ? '••••••••' : '';
            document.getElementById('profile-birth').textContent = p.birthdate || '';
            document.getElementById('profile-username').textContent = p.username || '';
            document.getElementById('date-inscription').textContent = (p.createdAt||'').slice(0,10);
          }
        });
    } else {
      document.getElementById('date-inscription').textContent = '2023-09-24';
    }
    // Affichage/masquage carte vitale glassmorphism
    const vitaleBtn = document.getElementById('vitaleBtn');
    const vitaleGlass = document.getElementById('vitaleGlass');
    let vitaleVisible = false;
    vitaleBtn.onclick = () => {
      vitaleVisible = !vitaleVisible;
      vitaleGlass.style.display = vitaleVisible ? 'block' : 'none';
      vitaleBtn.textContent = vitaleVisible ? 'Masquer la carte vitale' : 'Afficher la carte vitale';
    };
  </script>
</body>
</html>
